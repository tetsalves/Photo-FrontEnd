(function(){Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))};Storage.prototype.getObject=function(a){return(a=this.getItem(a))&&JSON.parse(a)};var g=OP.Util.constructor.prototype,f=function(a){"undefined"!==typeof console&&console.log(a)};OP.Batch=new function(){var a=this;this._callbackAdd=function(b){b=b.result;a.collection.add(b.id,b);OP.Util.fire("callback:batch-add",b)};this.add=function(b){var d={};1<arguments.length&&(d=arguments[1]);f("[Util][Batch] adding "+b);
g.makeRequest("/photo/"+b+"/view.json",d,a._callbackAdd,"json","get")};this.remove=function(b){f("[Util][Batch] removing "+b);a.collection.remove(b)};this.clear=function(){f("[Util][Batch] clearing");this.collection.clear()};this.collection=function(){var b,a;a=localStorage.getObject("items")||{};return{add:function(e,c){a[e]=c;localStorage.setObject("items",a);b++},clear:function(){a={};localStorage.setObject("items",{});b=0;OP.Util.fire("callback:batch-clear")},getAll:function(){return a},getIds:function(){var b=
[];for(i in a)b.push(i);return b},getLength:function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b},remove:function(e){delete a[e];localStorage.setObject("items",a);b--;OP.Util.fire("callback:batch-remove",e)}}}()};OP.Tag=new function(){var a,b,d,e;e=function(){return Date.now()/1E3};d=function(c){var d=c.result,c=c.code;a=[];if(!(200!==c||!1===d)){for(c=0;c<d.length;c++)""!=d[c].id&&a.push(d[c].id);b=e();localStorage.setObject("tags",a);localStorage.setItem("tags-lastModified",b);OP.Util.fire("callback:tags-initialized");
OP.Util.fire("callback:tags-updated")}};this.init=function(c){c=c||!1;a=localStorage.getObject("tags")||null;b=parseInt(localStorage.getItem("tags-lastModified"))||0;c||null===a||0===a.length||b<e()-1800?OP.Util.makeRequest("/tags/list.json",{},d,"json","get"):OP.Util.fire("callback:tags-initialized")};this.getTags=function(){return a}}})();
